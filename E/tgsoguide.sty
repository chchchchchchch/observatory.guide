
 %\usepackage[utf8]{inputenc}
  
  \usepackage[defaultlines=5,all]{nowidow}
  \newcommand{\setwidowstandard}{\setnowidow[2]\setnoclub[2]}
  \setwidowstandard

  \usepackage{geometry}
  \usepackage{graphicx}
  \usepackage{pdfpages}
  \usepackage{seqsplit}
  \usepackage[hang,multiple]{footmisc}
  \usepackage{everypage}
  \usepackage{setspace}
  \usepackage{relsize}
  \usepackage{sectsty}
  \usepackage{titlesec}
  \usepackage[activate={true,nocompatibility},
              final,tracking=true,kerning=true,
              spacing=true,factor=1100,
              stretch=10,shrink=10]{microtype}

  % https://groups.google.com/forum/#!topic/pandoc-discuss/_tssxEsT0eg
  \usepackage{enumerate}
  \usepackage{enumitem}
  \usepackage{afterpage}
  \usepackage{etoolbox}
  \usepackage{marginnote}
  \usepackage{tocloft}
  \usepackage{csquotes}
  \usepackage{fancyhdr}
  \usepackage{fancyvrb}
  \usepackage{alltt}      % USED BY QUAVERBATIM
 %\usepackage{hyperref}
  \usepackage{refcount}   % USED BY \imgshift
  \usepackage{float}
  \usepackage{wrapfig}

% --------------------------------------------------------------------------- %
%  F O R M A T
% --------------------------------------------------------------------------- %

  % A6
  \setlength\textheight{.83\paperheight}
  \setlength\textwidth{.72\paperwidth}
  \setlength\topmargin{-.17\paperheight}
  \setlength\oddsidemargin{-.05\paperwidth}
  \setlength\evensidemargin{-.13\paperwidth}

% --------------------------------------------------------------------------- %
%  B A S I C
% --------------------------------------------------------------------------- %
  \setlength\marginparwidth{1.0cm}
  \setlength\marginparsep{5pt} % 6pt

  \parindent=0pt
  \setlength{\parskip}{5pt plus 5pt minus 5pt}
  \setstretch{1.3} % LINEHEIGHT % (P:setspace)

  \renewcommand*{\chapterheadstartvskip}{\vspace{0pt}}
  \renewcommand*{\chapterheadendvskip}{\vspace{0pt}}
  \titlespacing\section{0pt}{20pt plus 30pt minus 15pt}{2pt plus 3pt minus 0pt}

  \newcommand\urlf[1]{{\tt #1}}
  \newcommand\urlsplit[1]{\seqsplit{\tt #1}}

  % https://groups.google.com/forum/#!topic/pandoc-discuss/O-N0H1eBnVU
  % \let\oldhref=\href
  % \renewcommand{\href}[2]{#2\footnote{#1}}
  % \newcommand{\href}[2]{#2\footnote{#1}}
  \newcommand{\href}[2]{
   \iffootnote #2 ({\tt\tiny\seqsplit{#1}})
   \else #2\footnote{#1} \fi
   }

  % http://tex.stackexchange.com/questions/167823/
  % -> multiply-define-a-label-on-purpose
  \makeatletter
  \def\@newl@bel#1#2#3{{%
    \@ifundefined{#1@#2}%
      {\def\tmp{#3}}%
      {%
  \edef\tmp{%
    {\expandafter\expandafter\expandafter\@firstoftwo\csname#1@#2\endcsname,
     \@firstoftwo#3}%
    {\expandafter\expandafter\expandafter\@secondoftwo\csname#1@#2\endcsname,
     \@secondoftwo#3}%
  }}%
      \expandafter\xdef\csname#1@#2\endcsname{\tmp}%
  }}
  \def\@testdef #1#2#3{}
  \makeatother

% DON'T START CHAPTER ON NEW PAGE AUTOMATICALLY
%  \makeatletter
%  \patchcmd{\chapter}{\if@openright\cleardoublepage\else\clearpage\fi}{}{}{}
%  \makeatother

% PREVENT HYPHENATION FOR WORDS STARTING WITH UPPERCASE
% \uchyph=0
% PREVENT HYPHENATION OVER PAGE BREAK
  \brokenpenalty10000\relax
% PREVENT PAGE BREAK WITHIN LISTS
%  \let\ITEMIZE\itemize
%  \let\ENDITEMIZE\enditemize
%  \renewenvironment{itemize}{\begin{samepage}\ITEMIZE}
%                            {\ENDITEMIZE\end{samepage}}

% --------------------------------------------------------------------------- %
% P A G E   H E A D E R /  F O O T E R
% --------------------------------------------------------------------------- %

  % http://texblog.org/2007/11/07/headerfooter-in-latex-with-fancyhdr
  \pagestyle{fancy}
  \fancyhead{} % CLEAR DEFAULT
  \fancyfoot{} % CLEAR DEFAULT
  \fancyfoot[LO]{\vspace{-8mm} \hspace{-13mm} {\scriptsize\thepage}}
  \fancyfoot[RE]{\vspace{-8mm} {\scriptsize\thepage} \hspace{-13mm}}

  % http://tex.stackexchange.com/questions/114956/
  % -> how-to-insert-footer-in-first-pages-of-chapter 
  \fancypagestyle{plain}{%
  \fancyfoot[LO]{\vspace{-8mm} \hspace{-13mm} {\scriptsize\thepage}}
  \fancyfoot[RE]{\vspace{-8mm} {\scriptsize\thepage} \hspace{-13mm}}
  }

  \renewcommand{\headrulewidth}{0pt}

% --------------------------------------------------------------------------- %
%  F O N T S
% --------------------------------------------------------------------------- %

  \newcommand{\ttstandard}{grm}
  \newcommand{\rmstandard}{phv}
  \newcommand{\sfstandard}{phv}

 % ttneu
  \let\OldTexttt\texttt
  \renewcommand{\texttt}[1]{%
  \OldTexttt{\fontfamily{\ttstandard}%
              \selectfont{%
              %\relscale{1.05}{#1}}}}
               \relscale{.95}{#1}}}}

   \newcommand{\embody}{}
 % CHANGE \emph FOR BODYTEXT
   \DeclareTextFontCommand{\emph}{%
     \ifbodytext%
     \embody
     \else\em %
     \fi%
    }

   \renewcommand*{\ttdefault}{\ttstandard}\selectfont
   \renewcommand*{\rmdefault}{\rmstandard}\selectfont
   \renewcommand*{\sfdefault}{\sfstandard}\selectfont
   \renewcommand\urlsplit[1]{\seqsplit{\tt\tiny ##1}}
   \renewcommand\urlf[1]{{\scalefont{.8}\tt ##1}}
  %\renewcommand{\embody}{\fontfamily{pju}\fontshape{it}%
  %                       \selectfont\relscale{1.2}}
   \renewcommand{\embody}{\it}
   \renewcommand{\texttt}[1]{%
   \OldTexttt{\fontfamily{\ttstandard}%
               \selectfont{%
                \relscale{.95}{##1}}}}
   \fontsize{8pt}{8pt}


% --------------------------------------------------------------------------- % 
%  H E A D L I N E S
% --------------------------------------------------------------------------- % 
  \chapterfont{\large\setstretch{1.0}}
  \sectionfont{\relscale{1.1}}
  \subsectionfont{\relscale{0.9}}

  \let\Chapter\chapter
  \renewcommand\chapter[1]{\Chapter*{#1}}
  \let\Section\section
  \renewcommand\section[1]{\newpage\Section*{#1}}
  \let\Subsection\subsection
  \renewcommand\subsection[1]{\newpage\Subsection*{#1}}
  \let\Subsubsection\subsubsection
  \renewcommand\subsubsection[1]{\newpage\Subsubsection*{#1}}


% --------------------------------------------------------------------------- % 
%  F O O T N O T E S  
% --------------------------------------------------------------------------- % 
 
  \renewcommand{\footnotelayout}{\raggedright} 
 
% SMALLER DISTANCE FOOTNOTENUMBER AND TEXT 
  \let\oldfootnote\footnote 
% \, = small non-breaking space 
  \renewcommand\footnote[1]{\,\oldfootnote{#1}} 
  \setlength{\footnotemargin}{1em} 
  \setlength{\footskip}{15mm} 
 % ABSTAND TRENNLINIE FUSSNOTEN 
   \renewcommand{\footnoterule}{ 
    \vspace*{5mm} 
     \noindent 
      \rule{\textwidth}{0.5pt}{ 
       \vspace*{-3pt} 
  }} 
% SAVE FOR RESET 
  \newlength{\SKIPFOOTINS} 
  \setlength{\SKIPFOOTINS}{\skip\footins}

% --------------------------------------------------------------------------- %
% Q U O T E
% --------------------------------------------------------------------------- %
  \makeatletter
  \renewenvironment{quote}
                {\list{}{\listparindent=0pt%whatever you need
                         \itemindent    \listparindent
                         \leftmargin=5pt%  whatever you need
                         \rightmargin=10pt%whatever you need
                         \topsep=2pt%%%%%  whatever you need
                        %\parsep        \z@ \@plus\p@
                         \sl \raggedright
                        }%
                 \item\relax}
                {\endlist}
  \makeatother

% --------------------------------------------------------------------------- %
% L I S T S
% --------------------------------------------------------------------------- %

  \setitemize[0]{leftmargin=10pt,rightmargin=10pt} % (P:enumitem)
  \setlist{noitemsep} % (P:enumitem)

%  \newcommand{\AtEndQuote}{}%
%  \AtEndEnvironment{quote}{\AtEndQuote}
%
%  \newcommand{\AtBeginQuote}{}%
%  \AtBeginEnvironment{quote}{\AtBeginQuote}

% --------------------------------------------------------------------------- %
% ENVIRONMENTS
% --------------------------------------------------------------------------- %
  \newenvironment{quaverbatim}{%
   \begin{alltt}%
    \fontsize{6pt}{7pt}\selectfont
  }{\end{alltt}}

  \newenvironment{verbatimsmall}{%
   \begin{alltt}%
    \fontsize{6pt}{7pt}\selectfont
  }{\end{alltt}}

% --------------------------------------------------------------------------- %
%  P A G E   C O M M A N D S
% --------------------------------------------------------------------------- %
  \newcommand{\emptypage}{ % SOMEHOW HACKY
   \twocolumn[]\thispagestyle{empty} %
    \onecolumn %
   }
% --------------------------------------------------------------------------- %
  \newcommand\cleartoleft{%
  \clearpage
  \ifthispageodd{\emptypage}{}
 }
% --------------------------------------------------------------------------- %
  \newcommand\cleartoright{%
  \clearpage
% http://tex.stackexchange.com/questions/6143/if-then-else-for-odd-page-even-page
  \ifthispageodd{}{\emptypage}
 }
% --------------------------------------------------------------------------- %

% --------------------------------------------------------------------------- %
% GRAPHICS
% --------------------------------------------------------------------------- %

 % VERTICAL SPACE HACK
 % http://tex.stackexchange.com/questions/61627/
 % -> prevent-action-if-top-of-page
% \newcommand\vspacenotonpagetop{%
%    \par % make sure we end a paragraph
%    \vskip10pt % space above the rule
%    \leaders\vrule width \textwidth\vskip0pt % rule thickness is 0pt
%    \nointerlineskip % disable interline glue here
%    \vskip10pt % space below the rule
% }
   \reversemarginpar
    \newcommand{\marginicon}[1]{%
      \marginpar{
        ~ \\ % NOTHING NEEDED
        \vspace{-1mm}\\
         \includegraphics[width=\marginparwidth]{#1}
    }%\vspace{-3mm}
   }
% --------------------------------------------------------------------------- % 
  % \usepackage{wrapfig}
  %
  % r R right side of the text
  % l L left side of the text
  % i I inside edge–near the binding (in a twoside document)
  % o O outside edge–far from the binding
  % The uppercase version allows the figure to float.
  % The lowercase version means exactly here.

  % https://tex.stackexchange.com/questions/120926/
  % -> prevent-wrapfigure-from-wrapping-the-next-section

  \newcommand{\imgsmall}[3]{
   \begin{wrapfigure}{I}{.25\textwidth}%
    \vspace{-.02\textwidth}%
     \includegraphics[width=.25\textwidth]{#1}
     \if\relax\detokenize{#2}\relax
      \else \footnotemark \fi
        \vspace{-5mm}
   \end{wrapfigure}
   \vfill
    \if\relax\detokenize{#2}\relax
     \else \footnotetext{#2} \fi
  }
% --------------------------------------------------------------------------- % 
  \newcommand{\imgwide}[3]{
   \bigskip
    \vfill

     \includegraphics[width=\textwidth]{#1}
      \label{#3}
       \if\relax\detokenize{#2}\relax
      % EMPTY
        \else
        % NON-EMPTY
          {\tiny#2}
       \fi
   \vfill
  }
% --------------------------------------------------------------------------- % 
  \newcommand{\imgwidefloat}[3]{
   \begin{figure}%
    \includegraphics[width=\textwidth]{#1}%
     \label{#3}
      \if\relax\detokenize{#2}\relax
      % EMPTY
        \else
        % NON-EMPTY
          {\tiny#2}
      \fi
   \end{figure}%
  }
% --------------------------------------------------------------------------- % 
  \reversemarginpar
    \newcommand{\anchormarginicon}[1]{%
      \marginpar{
        ~ \\ % NOTHING NEEDED
        \vspace{-1\baselineskip}\\
         \includegraphics[width=\marginparwidth]{#1}
    }
  }
% --------------------------------------------------------------------------- % 
  \newcommand{\anchorinlineicon}[1]{%
    \vspace{.5\baselineskip}%
    \includegraphics[height=1.5\baselineskip]{#1}
  }
% --------------------------------------------------------------------------- % 
  \newcommand\anchorinfo[2]{%
       {\footnotesize
        \color{black}
       {\hspace{-1em}\anchorinlineicon{exclamation}%
        \vspace{-.5\baselineskip}%
        \setstretch{1.2} p.\pageref{#2}
        -- #1 \par}}
       \smallskip\vfill
  }
% --------------------------------------------------------------------------- % 
  \newcommand\anchor[3]{%
    \if\relax\detokenize{#3}\relax
    % #3 EMPTY -> DO NOTHING IN PLACE
    \else
    % #3 NON-EMPTY -> CREATE ANCHOR IN PLACE
      \if\relax\detokenize{#1}\relax
      % #1 EMPTY -> INSERT ANCHOR ONLY
       \anchormarginicon{margin}
       \marginpar{\centering\tiny p.~\pageref{#2}} % NON-EMPTY
      \else
      % #1 NON-EMPTY -> INSERT INFO + ANCHOR
       \anchorinfo{#1}{#2}
      \fi
    \fi

  }
% --------------------------------------------------------------------------- %
  \newcommand\pageinfo[4]{%
   \if\relax\detokenize{#4}\relax
    % #4 EMPTY -> DO NOTHING
    \else % #4 NON-EMPTY
    \if\relax\detokenize{#3}\relax
     \makebox[\textwidth][l]{%
      \hspace{#1}%
       \parbox{\textwidth}{%
        \vspace{#2}
         \colorbox{black}{%
         {\small\parbox{.97\textwidth}{
           \smallskip
            \color{white} #4 %
             \smallskip}
     }}}}
     \fi
    \fi
  }
% --------------------------------------------------------------------------- %
   \newcounter{floats}
   \newcounter{pagenow}
 % ------------------------------------------------------------------------ %
   \newcommand{\imgshift}[5]{
      % ------------------------------------ %
      % INSERT ANCHOR (OPTIONAL)
        \anchor{#5}{#3}{#4}
      % ------------------------------------ %
      % INSERT FULL SIZE IMAGE (+SHIFT) ASAP
       \begin{figure}[p]
      % ---------
        \stepcounter{floats}  % INCREASE COUNTER ..
        \label{FF:\thefloats} % .. TO CREATE A UNIQ LABEL
        \setcounterpageref{pagenow}{FF:\thefloats}
      % PLACE IMAGE ---------
      % https://tex.stackexchange.com/a/44176
        \vspace*{\dimexpr-1in-\topmargin-\headsep-\headheight}%
         \ifodd\value{pagenow}
          \hspace*{\dimexpr-1in-\oddsidemargin-\parindent}%
         \else
            \hspace*{\dimexpr-1in-\evensidemargin-\parindent}%
          \fi
         \makebox[\paperwidth][l]{
          \setlength{\unitlength}{.95\paperwidth}%
           \put(-#2,0){%
            \includegraphics[height=\paperheight]{#1}%
            }%
          }%
      % PLACE INFO  -------- 
         \ifodd\value{pagenow} %
          \pageinfo{-.0\textwidth}{-.35\textheight}{#4}{#5}
           \else %
            \pageinfo{-1.25\textwidth}{-.3\textheight}{#4}{#5}
          \fi
      % ---------
        \label{#3}
        \end{figure}
      % ------------------------------------ %
  }
% --------------------------------------------------------------------------- %
  \newcommand{\imghuge}[4]{
      % ------------------------------------ %
      % INSERT ANCHOR (OPTIONAL)
        \anchor{#4}{#2}{#3}
      % ------------------------------------ %
      % PLACE IMAGE ASAP
       \begin{figure}[p]
      % ---------
        \stepcounter{floats}  % INCREASE COUNTER ..
        \label{FF:\thefloats} % .. TO CREATE A UNIQ LABEL
        \setcounterpageref{pagenow}{FF:\thefloats}
      % PLACE IMAGE ---------
        \includegraphics[width=\textwidth]{#1}%
      % PLACE INFO  -------- 
         \ifodd\value{pagenow} %
          \pageinfo{-.0\textwidth}{.25\textheight}{#3}{#4}
           \else %
            \pageinfo{-1\textwidth}{.55\textheight}{#3}{#4}
          \fi
      % ---------
        \label{#2}
        \end{figure}
  }
% --------------------------------------------------------------------------- %

  % BESCHRIFTUNG FÜR PDFPAGESPLUS
  % -----------------------------
    \newcommand\pdfpagesplusinfo[2]{
   % RM FOOTNOTE NUMBER
    \deffootnote[1.5em]{1.5em}{1em}{\textsuperscript{}}
      % https://tex.stackexchange.com/questions/53068/
      % -> how-to-check-if-a-macro-value-is-empty
      \if\relax\detokenize{#2}\relax
      % #2 (=SWITCH) EMPTY
      % -> ANCHOR WAS NOT SET
      % -> INSERT TEXT HERE
      \footnotetext{\footnotesize{#1}}
      \else
      % #2 (=SWITCH) NON-EMPTY
      % -> ANCHOR WAS SET
      % -> DO NOTHING HERE
      \fi
    }

   \newcommand\pdfpagesplus[7]{%
   \if\relax\detokenize{#6}\relax
   % #6 EMPTY -> DO NOTHING IN PLACE
   \else
   % #6 NON-EMPTY -> CREATE ANCHOR IN PLACE
     \marginicon{#7}
     \if\relax\detokenize{#4}\relax
     % #4 EMPTY -> INSERT ANCHOR ONLY
     \marginpar{\tiny p.~\pageref{#5}} % NON-EMPTY
     \else
     % #4 NON-EMPTY -> INSERT INFO + ANCHOR
     {\scriptsize
     #4, see p.~\pageref{#5}} % NON-EMPTY
     \fi
   \fi
   \afterpage{
   \renewcommand{\footnoterule}{\rule{0pt}{0pt}}
   \includepdf[pagecommand={\thispagestyle{fancy}}%
               \label{#5}\pdfpagesplusinfo{#4}{#6},%
               offset=10 10, delta=5 5,
               scale=.75,frame,pages=#2,nup=#3]{#1}
   }
  }

% --------------------------------------------------------------------------- %
% MDSH TGSO GUIDE
% --------------------------------------------------------------------------- %

   \newcommand\grouping[1]{%
    \cleartoleft
     {\LARGE #1}
      \cleartoright
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptormethod[1]{%
    \cleartoright
     {\large\textbf{METHOD: #1}}
       \medskip
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorwhat[1]{%

    \textbf{What:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorwho[1]{%

    \textbf{Who:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorwhy[1]{%

    \textbf{Why:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorwhen[1]{%

    \textbf{When:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorhow[1]{%

    \textbf{How:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorabout[1]{%

    \textbf{About:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptornote[1]{%

    \textbf{Note:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorwarning[1]{%

    \textbf{Warning:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorexample[1]{%

    \textbf{Example:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorremember[1]{%

    \textbf{Remember:} #1
   }
 % ------------------------------------------------------------------------- %
   \newcommand\descriptorurgency[1]{%

    \textbf{Urgency:} #1
   }
 % ------------------------------------------------------------------------- %

